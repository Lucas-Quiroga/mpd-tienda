import{j as e}from"./utils.CV4bOxs7.js";import{r as i}from"./index.DgOxCJIz.js";import{u as I,C as k,t as T,L as A,I as F}from"./zod.D9YB93N9.js";import{B as D}from"./button.DHZLWCb5.js";import{T as P,C as f,p as L}from"./textarea.9KZthtQy.js";import{a as O,u as U}from"./client.DzQM3-ZA.js";import{S as R,a as B,b as V,c as z,e as G,f as M,d as _}from"./select.CqKRm9gn.js";import{D as $}from"./const.D9r1vPbu.js";import{g as q}from"./index-454a0f5f.C86mfHgW.js";import{u as H,S as J}from"./spinner.D9hkknOv.js";import"./index.DOI0olcG.js";import"./index.C3AoWCtw.js";import"./index.DUh_eYIC.js";import"./index.XIRROYMS.js";import"./check.BEeCP_sz.js";import"./createLucideIcon.ZND8IBUW.js";import"./floating-ui.react-dom.CbzikqG6.js";import"./component.CGzGt9PZ.js";import"./tslib.es6.CDuPK5Eb.js";import"./chevron-down.CULRotgZ.js";function ge(){const[u,a]=i.useState(null),[h,x]=i.useState(null),[s,l]=i.useState(null),{execute:m,isLoading:c}=H(),{register:d,formState:{errors:n},handleSubmit:g,reset:j,control:S}=I({resolver:T(L)}),N=i.useCallback(r=>Object.fromEntries(Object.entries(r).map(([t,o])=>[t,o===void 0?null:o])),[]),y=i.useCallback(async r=>{r=N(r);try{const o=q(O).currentUser;if(!o)return;await o.getIdToken(!0);let C="";s&&(C=await U(s),r.image=C),r.avaliable=!!r.avaliable;const v=new FormData;Object.entries(r).forEach(([w,b])=>{b!==null&&v.append(w,w==="avaliable"?b?"on":"off":b.toString())}),await m("/api/products",{method:"POST",body:v})?(x("Producto cargado exitosamente"),j({name:"",image:"",description:"",price:0,category:"",avaliable:!1}),l(null),setTimeout(()=>x(null),2e3)):(a("Error al cargar el producto"),setTimeout(()=>a(null),2e3))}catch(t){console.error("Error completo:",t),a(t instanceof Error?`Error adding product: ${t.message}`:"An unknown error occurred")}},[N,m,s,j]),E=i.useCallback(r=>{r.target.files&&l(r.target.files[0])},[]);return e.jsxs("section",{className:"flex flex-col gap-6 p-4 md:p-6 justify-center items-center h-[100vh]",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Agregar Nuevo Producto"}),e.jsxs("form",{onSubmit:g(y),className:"flex flex-col justify-center max-w-md m-0 p-0 gap-4",children:[h&&e.jsxs("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 my-4",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Producto cargado exitosamente"}),e.jsx("p",{children:"¡El producto se cargó correctamente!"})]}),u&&e.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 my-4",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Error al cargar el producto"}),e.jsx("p",{children:u})]}),e.jsx(p,{label:"Nombre",id:"name",type:"text",placeholder:"Ingresa el nombre del producto",register:d,errors:n}),e.jsx(p,{label:"Imagen",id:"image",type:"file",onChange:E}),s&&e.jsx("img",{src:URL.createObjectURL(s),alt:"product",className:"w-1/2 object-contain mx-auto"}),e.jsx(p,{label:"Descripción",id:"description",as:P,placeholder:"La descripción",register:d,errors:n,maxLength:210}),e.jsx(p,{label:"Precio",id:"price",type:"number",placeholder:"Ingresa el precio del producto",register:d,errors:n}),e.jsx(p,{label:"Disponible",id:"avaliable",as:f,control:S}),e.jsx(k,{name:"category",control:S,render:({field:r})=>e.jsxs(R,{value:r.value,onValueChange:r.onChange,children:[e.jsx(B,{className:"w-full dark:text-white",children:e.jsx(V,{placeholder:"Selecciona la categoría"})}),e.jsx(z,{children:e.jsxs(G,{children:[e.jsx(M,{children:"Categorías"}),$.categories.map((t,o)=>e.jsx(_,{value:t,children:t},o))]})})]})}),e.jsx(D,{type:"submit",disabled:c,className:"w-full",children:c?e.jsx(J,{size:"medium"}):"Agregar Producto"})]})]})}const p=({label:u,id:a,type:h="text",placeholder:x,register:s,errors:l,as:m=F,maxLength:c,onChange:d,control:n})=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:a,className:"dark:text-white",children:u}),n&&m===f?e.jsx(k,{name:a,control:n,render:({field:g})=>e.jsx(f,{id:a,checked:g.value,onCheckedChange:g.onChange})}):e.jsx(m,{id:a,type:h,placeholder:x,...s?s(a):{},onChange:d,maxLength:c,className:"dark:text-white"}),c&&e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-gray-50",children:["Máximo ",c," caracteres."]}),l&&l[a]&&e.jsx("span",{className:"text-red-500",children:l[a].message})]});export{ge as default};
