import{r as i}from"./index.DgOxCJIz.js";import{r as g}from"./index.C3AoWCtw.js";function E(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function O(...n){return e=>n.forEach(t=>E(t,e))}function y(...n){return i.useCallback(O(...n),n)}var A=globalThis?.document?i.useLayoutEffect:()=>{};function R(n,e){return i.useReducer((t,o)=>e[t][o]??t,n)}var M=n=>{const{present:e,children:t}=n,o=T(e),a=typeof t=="function"?t({present:o.isPresent}):i.Children.only(t),c=y(o.ref,h(a));return typeof t=="function"||o.isPresent?i.cloneElement(a,{ref:c}):null};M.displayName="Presence";function T(n){const[e,t]=i.useState(),o=i.useRef({}),a=i.useRef(n),c=i.useRef("none"),l=n?"mounted":"unmounted",[N,s]=R(l,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return i.useEffect(()=>{const r=d(o.current);c.current=N==="mounted"?r:"none"},[N]),A(()=>{const r=o.current,u=a.current;if(u!==n){const p=c.current,f=d(r);n?s("MOUNT"):f==="none"||r?.display==="none"?s("UNMOUNT"):s(u&&p!==f?"ANIMATION_OUT":"UNMOUNT"),a.current=n}},[n,s]),A(()=>{if(e){const r=m=>{const f=d(o.current).includes(m.animationName);m.target===e&&f&&g.flushSync(()=>s("ANIMATION_END"))},u=m=>{m.target===e&&(c.current=d(o.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",r),e.addEventListener("animationend",r),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",r),e.removeEventListener("animationend",r)}}else s("ANIMATION_END")},[e,s]),{isPresent:["mounted","unmountSuspended"].includes(N),ref:i.useCallback(r=>{r&&(o.current=getComputedStyle(r)),t(r)},[])}}function d(n){return n?.animationName||"none"}function h(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}export{M as P};
